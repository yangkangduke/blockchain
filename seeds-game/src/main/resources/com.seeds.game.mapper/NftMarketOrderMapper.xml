<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.seeds.game.mapper.NftMarketOrderMapper">
    <select id="getSkinPage" resultType="com.seeds.game.dto.response.NftMarketPlaceSkinResp"
            parameterType="com.seeds.game.dto.request.NftMarketPlaceSkinPageReq">
        select t1.name,
        t1.price,
        t1.image,
        t1.token_id,
        t1.model,
        t2.rarity
        from ga_nft_public_backpack t1
        left join ga_nft_attribute t2 on t1.token_id = t2.token_id and t1.token_address = t2.mint_address
        where t1.type = 4

            <if test="name != null">
                and t1.name = #{name}
            </if>
            <if test="tokenId != null">
                and t1.token_id = #{tokenId}
            </if>
            <if test="status != null">
                and t1.model = #{status}
            </if>
            <if test="rarity != null">
                and t2.rarity = #{rarity}
            </if>
            <if test="heroType != null">
                and t2.hero_type = #{heroType}
            </if>
            <if test="sort != null and sort =='price'">
                order by t1.price ${sortType}
            </if>
            <if test="sort != null and sort =='rarity'">
                order by t2.rarity ${sortType}
            </if>
            <if test="sort != null and sort =='durability'">
                order by t2.durability ${sortType}
            </if>
            <if test="minPrice > 0">
                and t1.price &gt;= #{minPrice,jdbcType=BigDecimal}
            </if>
            <if test="maxPrice > 0">
                and t1.price &lt;= #{maxPrice,jdbcType=BigDecimal}
            </if>
    </select>
    <select id="getEquipPage" resultType="com.seeds.game.dto.response.NftMarketPlaceEqiupmentResp"
            parameterType="com.seeds.game.dto.request.NftMarketPlaceEquipPageReq">
        select t1.name,
        t1.price,
        t1.image,
        t1.token_id,
        t1.grade,
        t1.model,
        t2.durability
        from ga_nft_public_backpack t1
        left join ga_nft_attribute t2 on t1.token_id = t2.token_id and t1.token_address = t2.mint_address
        where t1.type = 1

        <if test="name != null">
            and t1.name = #{name}
        </if>
        <if test="tokenId != null">
            and t1.token_id = #{tokenId}
        </if>
        <if test="status != null">
            and t1.model = #{status}
        </if>
        <if test="grade != null">
            and t1.grade = #{grade}
        </if>
        <if test="durability != null">
            and t2.durability = #{durability}
        </if>
        <if test="sort != null and sort =='price'">
            order by t1.price ${sortType}
        </if>
        <if test="sort != null and sort =='grade'">
            order by t1.grade ${sortType}
        </if>
        <if test="sort != null and sort =='durability'">
            order by t2.durability ${sortType}
        </if>
        <if test="minPrice > 0">
            and t1.price &gt;= #{minPrice,jdbcType=BigDecimal}
        </if>
        <if test="maxPrice > 0">
            and t1.price &lt;= #{maxPrice,jdbcType=BigDecimal}
        </if>
    </select>
    <select id="getPropsPage" resultType="com.seeds.game.dto.response.NftMarketPlacePropsResp"
            parameterType="com.seeds.game.dto.request.NftMarketPlacePropsPageReq">
        select t1.name,
        t1.price,
        t1.image,
        t1.token_id,
        t1.grade,
        t1.model,
        t2.durability
        from ga_nft_public_backpack t1
        left join ga_nft_attribute t2 on t1.token_id = t2.token_id and t1.token_address = t2.mint_address
        where t1.type = 2

        <if test="name != null">
            and t1.name = #{name}
        </if>
        <if test="tokenId != null">
            and t1.token_id = #{tokenId}
        </if>
        <if test="status != null">
            and t1.model = #{status}
        </if>
        <if test="grade != null">
            and t1.grade = #{grade}
        </if>
        <if test="durability != null">
            and t2.durability = #{durability}
        </if>
        <if test="sort != null and sort =='price'">
            order by t1.price ${sortType}
        </if>
        <if test="sort != null and sort =='grade'">
            order by t1.grade ${sortType}
        </if>
        <if test="sort != null and sort =='durability'">
            order by t2.durability ${sortType}
        </if>
        <if test="minPrice > 0">
            and t1.price &gt;= #{minPrice,jdbcType=BigDecimal}
        </if>
        <if test="maxPrice > 0">
            and t1.price &lt;= #{maxPrice,jdbcType=BigDecimal}
        </if>
    </select>
</mapper>